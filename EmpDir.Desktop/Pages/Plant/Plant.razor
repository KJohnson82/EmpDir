@page "/plant"

@inject IDirectoryService DirectoryService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject LayoutState LayoutState

<PageTitle>Plants</PageTitle>

@* Loading state *@
@if (Plants == null || Plants.Count == 0)
{
    <p>Loading plant data...</p>
}
else
{
    @* Scrollable list of manufacturing plant locations *@
    <div class="button-page-container">
        <div class="scrollable-wrapper">
            <TelerikListView Data="@Plants" EnableLoaderContainer="true" Class="button-list-container">
                <Template Context="plant">
                    <NavLink href="@($"/plant/{plant.Id}")" class="link-body-emphasis k-text-no-underline k-shadow">
                        <div class="menu-item k-d-flex k-flex-row k-text-uppercase k-font-size-lg k-font-semibold k-text-white k-justify-content-start k-align-items-center k-pl-10 k-bg-gradient k-py-6 hover:k-elevation-2">
                            @plant.LocName
                        </div>
                    </NavLink>
                </Template>
            </TelerikListView>
        </div>
    </div>
}

@code {
    // Manufacturing plant locations sorted alphabetically
    private List<LocationDto>? Plants = new();

    // Header model with manufacturing and operations management hierarchy
    private HeaderCardModels.HeadInfoCardModel? PlantInfo;

    private List<FooterNav.FooterItem> FooterNav => FooterNavigation.PlantSection;

    // Load plant locations and configure management hierarchy header
    protected override async Task OnInitializedAsync()
    {
        Plants = await DirectoryService.GetLocationsByTypeAsync("plant");

        // Sort alphabetically for intuitive navigation
        Plants = Plants.OrderBy(p => p.LocName).ToList();

        // Create header with manufacturing and operations management hierarchy
        PlantInfo = HeaderCardModels.Plant(
            title: "Plants",
            subtitle1: "Corp Manuf. Mgr",
            tmanager1: "Marc Scammerhorn",
            subtitle2: "Corp Traffic Mgr",
            tmanager2: "Steve Hunter",
            subtitle3: "Regional Ops Mgr",
            tmanager3: "Bruce Mancuso",
            subtitle4: "Regional Ops Mgr",
            tmanager4: "Teresa Taylor",
            subtitle5: "Regional Ops Mgr",
            tmanager5: "Jeff Hoopes",
            subtitle6: "Regional Ops Mgr",
            tmanager6: "Don Jones"
        );
    }

    // Configure layout state with plant header and footer
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender && PlantInfo != null)
        {
            LayoutState.SetHeader(PlantInfo);
            LayoutState.SetFooter(FooterNavigation.PlantSection);
        }
    }
}