@page "/metalmart"

@inject IDirectoryService DirectoryService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject LayoutState LayoutState

<PageTitle>Metal Mart</PageTitle>

@* Loading state *@
@if (Locations == null || Locations.Count == 0)
{
    <p>Loading Metal Marts...</p>
}
else
{
    @* Scrollable list of Metal Mart locations *@
    <div class="button-page-container">
        <div class="scrollable-wrapper">
            <TelerikListView Data="@Locations" Class="button-list-container">
                <Template Context="loc">
                    <NavLink class="text-decoration-none text-uppercase"
                             href="@($"/metalmart/{loc.Id}")">
                        <div class="menu-item py-3 px-4 my-2 rounded-3 k-text-white tracking-wider k-font-size-lg" style="font-size: medium; font-weight: bold; letter-spacing: 2px;">
                            <div class="k-align-items-center">@loc.LocName</div>
                            <div class="k-color-dark k-font-bold k-font-size-sm">@loc.City, @loc.State</div>
                        </div>
                    </NavLink>
                </Template>
            </TelerikListView>
        </div>
    </div>
}

@code {
    // Header model with Metal Mart territory management hierarchy
    private HeaderCardModels.HeadInfoCardModel? StoreInfo;

    // Collection of Metal Mart locations sorted by location number
    private List<LocationDto> Locations = new();

    // Store location entity (preserved for potential future use)
    private LocationDto? Store;

    private List<FooterNav.FooterItem> FooterNav => FooterNavigation.MetalMartSection;

    // Load Metal Mart locations and configure territory management header
    protected override async Task OnInitializedAsync()
    {
        Locations = await DirectoryService.GetLocationsByTypeAsync("metal mart");

        // Sort by location number for logical ordering
        Locations = Locations.OrderBy(l => l.LocNum).ToList();

        // Create header with territory management hierarchy
        StoreInfo = HeaderCardModels.AreaManagers(
            title: "Metal Mart",
            subtitle1: "Northeast",
            tmanager1: "David Boyte",
            subtitle2: "Central",
            tmanager2: "John Baker",
            subtitle3: "South Central",
            tmanager3: "Beau Brown",
            subtitle4: "New Mexico",
            tmanager4: "Cliff Loveless",
            subtitle5: "Southeast",
            tmanager5: "Michael Northen",
            subtitle6: "Southwest",
            tmanager6: "Shaun Steinemann"
         );
    }

    // Configure layout state with Metal Mart header and footer
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender && StoreInfo != null)
        {
            LayoutState.SetHeader(StoreInfo);
            LayoutState.SetFooter(FooterNavigation.MetalMartSection);
        }
    }
}