@page "/servicecenter"

@inject IDirectoryService DirectoryService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@inject LayoutState LayoutState

<PageTitle>Service Center</PageTitle>

@* Loading state *@
@if (Locations == null || Locations.Count == 0)
{
    <p>Loading Service Centers...</p>
}
else
{
    @* Scrollable list of Service Center locations *@
    <div class="button-page-container">
        <div class="scrollable-wrapper">
            <TelerikListView Data="@Locations" Class="button-list-container">
                <Template Context="loc">
                    <NavLink class="text-decoration-none text-uppercase"
                             href="@($"/servicecenter/{loc.Id}")">
                        <div class="menu-item py-3 px-4 my-2 rounded-3 k-text-white tracking-wider k-font-size-lg" style="font-size: medium; font-weight: bold; letter-spacing: 2px;">
                            <div class="k-align-items-center">@loc.LocName</div>
                            <div class="k-color-dark k-font-bold k-font-size-sm">@loc.City, @loc.State</div>
                        </div>
                    </NavLink>
                </Template>
            </TelerikListView>
        </div>
    </div>
}

@code {
    // Header model with Service Center area management hierarchy
    private HeaderCardModels.HeadInfoCardModel? StoreInfo;

    // Service Center locations sorted alphabetically by name
    private List<LocationDto> Locations = new();

    private List<FooterNav.FooterItem> FooterNav => FooterNavigation.ServiceCenterSection;

    // Load Service Center locations and configure area management header
    protected override async Task OnInitializedAsync()
    {
        Locations = await DirectoryService.GetLocationsByTypeAsync("service center");

        // Sort alphabetically by name (unlike Metal Mart which sorts by location number)
        Locations = Locations.OrderBy(l => l.LocName).ToList();

        // Create header with area management hierarchy
        StoreInfo = HeaderCardModels.AreaManagers(
            title: "Service Center",
            subtitle1: "Area Manager",
            tmanager1: "Rickie Furr",
            subtitle2: "Area Manager",
            tmanager2: "Mark Rollins",
            subtitle3: "Area Manager",
            tmanager3: "John Carter",
            subtitle4: "Area Manager",
            tmanager4: "Shaun Steinmen",
            subtitle5: "Area Manager",
            tmanager5: "Matthew Snudden",
            subtitle6: "SC Ops Manager",
            tmanager6: "Jeff Harrington"
        );
    }

    // Configure layout state with Service Center header and footer
    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender && StoreInfo != null)
        {
            LayoutState.SetHeader(StoreInfo);
            LayoutState.SetFooter(FooterNavigation.ServiceCenterSection);
        }
    }
}